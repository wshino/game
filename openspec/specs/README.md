# 大航海時代ゲーム - 仕様書

このディレクトリには、プロジェクトの現在の仕様が含まれています。

## 仕様ドキュメント

### 主要仕様
- **[完全仕様書](../../SPECIFICATIONS.md)** - 全機能の詳細な技術仕様
- **[ゲームデザイン](../../GAME_DESIGN.md)** - ゲームの設計思想と歴史的考証

## 概要

### ゲームコンセプト
15-16世紀の大航海時代を舞台にした、歴史的に考証された貿易シミュレーションゲーム。プレイヤーは商人として7つの歴史的な港を巡り、商品を売買して富を築く。

### コア機能

#### 1. 港システム (7港)
- リスボン (Portugal)
- セビリア (Spain)
- ヴェネツィア (Italy) - 最大規模
- アレクサンドリア (Egypt)
- カリカット (India)
- マラッカ (Malaysia)
- 長崎 (Japan) - 小規模

#### 2. 貿易システム
- **8種類の商品**: ワイン、織物、香辛料、絹、金鉱石、陶器、茶、銀
- **動的価格設定**: 港ごとの価格係数 × ランダム変動(±10%)
- **在庫管理**: 港の在庫が時間経過で回復
- **売買差額**: 売値 = 買値 × 0.8

#### 3. 船のアップグレード (4種類)
| 船名 | 積載量 | 速度 | 価格 |
|------|--------|------|------|
| カラベル船 | 100 | 1.0x | 0G (初期) |
| キャラック船 | 200 | 1.2x | 5,000G |
| ガレオン船 | 300 | 1.5x | 15,000G |
| 東インド会社船 | 500 | 2.0x | 50,000G |

#### 4. 航海システム
- **リアルタイム進行**: 15秒 = 1ゲーム日
- **天候システム**: 5種類の天候が速度に影響
- **補給品**: 食糧と水が必要（乗員数 × 日数 × 0.07）
- **航路可視化**: 世界地図上で船の位置をアニメーション表示
- **オフライン進行**: ブラウザを閉じても航海継続

#### 5. オートパイロット
- **自動貿易**: 1～24時間の自動運用
- **最適化アルゴリズム**: 利益最大化の貿易ルートを自動探索
- **在庫管理**: 港の在庫を考慮した購入計画
- **オフライン実行**: ページを閉じていても進行
- **レポート生成**: 取引履歴と利益の詳細表示

#### 6. セーブ/ロードシステム
- **LocalStorage**: 自動保存
- **航海中断/再開**: ページリロード後も航海継続
- **後方互換性**: 船の定義更新時も対応

## ゲーム進行フロー

```
初期状態 (リスボン、1000G、カラベル船)
    ↓
商品購入 (安い港で購入)
    ↓
航海 (遠い港ほど価格差大)
    ↓
商品売却 (高い港で売却)
    ↓
利益蓄積
    ↓
船アップグレード
    ↓
より効率的な貿易へ
```

## 技術スタック

- **フロントエンド**: Vanilla JavaScript (ES6+), HTML5, CSS3
- **フレームワーク**: なし（純粋なJavaScript実装）
- **ストレージ**: LocalStorage（ゲーム状態の永続化）
- **デプロイ**: GitHub Pages
- **開発**: Node.js 20+ (tooling only)

## アーキテクチャ

```
/src
├── core/              # 状態管理・定数
├── services/          # ビジネスロジック
│   ├── autopilot-service.js
│   ├── port-service.js
│   ├── supply-service.js
│   ├── save-service.js
│   ├── trade-service.js
│   └── voyage-service.js
├── ui/                # UI更新
├── utils/             # ユーティリティ
└── game.js            # エントリーポイント
```

## 計算式

### 価格計算
```javascript
buyPrice = basePrice × portMultiplier × random(0.9~1.1)
sellPrice = buyPrice × 0.8
```

### 航海時間
```javascript
estimatedDays = baseDays / shipSpeed
actualDays = estimatedDays + weatherDelays
```

### 補給品
```javascript
foodRequired = Math.ceil(crew × days × 0.07)
waterRequired = Math.ceil(crew × days × 0.07)
```

### 在庫回復
```javascript
newStock = Math.min(maxStock, currentStock + (refreshRate × daysPassed))
```

## ゲームバランス

詳細なバランス分析は [BALANCE_REPORT.md](../../BALANCE_REPORT.md) を参照。

### 主要な貿易ルート
1. **リスボン → 長崎** (ワイン輸出)
2. **長崎 → リスボン** (銀輸出)
3. **カリカット → ヨーロッパ** (香辛料輸出)

## 今後の拡張可能性

### 考えられる機能追加
- 戦闘システム（海賊との遭遇）
- 船員管理（雇用・解雇・経験値）
- イベントシステム（ランダムイベント）
- 実績システム（達成目標）
- 新しい港の追加
- 季節システム（季節による価格変動）

## 変更管理

新しい機能や変更の提案は、`openspec/changes/` ディレクトリに以下の構造で作成してください：

```
openspec/changes/[feature-name]/
├── proposal.md      # 変更の概要と理由
├── tasks.md         # 実装タスク
└── specs/           # 仕様の変更内容
```

## 参考資料

- [完全仕様書](../../SPECIFICATIONS.md) - 全機能の詳細
- [ゲームデザイン](../../GAME_DESIGN.md) - 設計思想
- [バランスレポート](../../BALANCE_REPORT.md) - ゲームバランス分析
- [README](../../README.md) - プロジェクト概要
